<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KidDic - 名言辞典</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>

    <!-- ハンバーガーメニューの実装 -->
    <header class="header">
        <div class="navtext-container">
            <a href="{% url 'home' %}" class="navtext">KidDic</a>
        </div>
        <input type="checkbox" class="menu-btn" id="menu-btn">
        <label for="menu-btn" class="menu-icon"><span class="navicon"></span></label>
        <ul class="menu">
            <li><a href="{% url 'account_info' %}">アカウント情報変更</a></li>
            <li><a href="#children-list">お子さま一覧</a></li>
            <li><a href="#invite-family">家族招待</a></li>
            <li><a href="#logout">ログアウト</a></li>
        </ul>
    </header>

    <main>
        <!-- 検索フォーム -->
        <section class="search-section">
            <form method="get" action="{% url 'home' %}" class="search-form">
                <input type="text" name="keyword" placeholder="キーワード" value="{{ request.GET.keyword }}" class="search-input">

                <!-- 年の選択肢 -->
                <!-- <label for="year_month">年月</label> -->
                <input type="month" id="year_month" name="year_month" class="search-select" value="{{ request.GET.year_month }}">

                <!-- カテゴリの選択肢 -->
                <select name="category" class="search-select">
                    <option value="">カテゴリ</option>
                    {% for category in categories %}
                        <option value="{{ category.id }}" {% if request.GET.category == category.id %}selected{% endif %}>{{ category.category_name }}</option>
                    {% endfor %}
                </select>

                <!-- 発言者の選択肢 -->
                <select name="speaker" class="search-select">
                    <option value="">発言者</option>
                    {% for child in children %}
                        <option value="{{ child.nickname }}" {% if request.GET.speaker == child.nickname %}selected{% endif %}>{{ child.nickname }}</option>
                    {% endfor %}
                </select>

                <!-- 検索ボタン -->
                <button type="submit" class="search-btn">検索</button>

                <!-- ソート順の選択肢 -->
                <select name="sort_order" class="search-select">
                    <option value="newest" {% if request.GET.sort_order == 'newest' %}selected{% endif %}>新着順</option>
                    <option value="alphabet" {% if request.GET.sort_order == 'alphabet' %}selected{% endif %}>五十音順</option>
                    <option value="year" {% if request.GET.sort_order == 'year' %}selected{% endif %}>年代順</option>
                </select>
            </form>
        </section>

        <!-- 名言カード -->
        <section class="quote-list">
            <div class="quote-grid">
                {% for quote in quotes %}
                <a href="{% url 'quote_detail' quote.id %}" class="quote-card-link">
                    <div class="quote-card">
                        <div class="quote-header">
                            <span>{{ quote.child.nickname }} {{ quote.child.age }}
                                <!-- 名言カードの表示部分 -->
                                {% if quote.start_date %}
                                    {{ quote.start_date|date:"Y/m/d" }}
                                    {% if quote.end_date %}
                                        ～ {{ quote.end_date|date:"Y/m/d" }}
                                    {% endif %}
                                {% endif %}
                            </span>                            
                            <a href="{% url 'quote_edit' quote.id %}" class="edit-link" onclick="event.stopPropagation();">編集</a>
                        </div>
                        <p>{{ quote.content }}</p>
                        <!-- 説明がある場合のみ表示 -->
                        {% if quote.description %}
                            <p>{{ quote.description }}</p>
                        {% endif %}
                        <div class="quote-footer">
                            {% if quote.image %}
                                <img src="{{ quote.image.url }}" alt="quote image" class="quote-image">
                            {% endif %}
                            <span>コメント数: {{ quote.comment_set.count }}</span>
                        </div>
                    </div>
                </a>
                {% empty %}
                <div class="quote-card">
                    <p>名言が登録されていません。</p>
                </div>
                {% endfor %}
            </div>
        </section>

    </main>   

    <!-- モーダルの構造 -->
    <div id="modalBackground" class="modal-background"></div>
    <div id="quoteModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeQuoteModal()">&times;</span>
            <form method="post" action="{% url 'home' %}" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="form-header">
                    <select name="child" id="child" class="child-select" required>
                        {% for child in children %}
                            <option value="{{ child.id }}">{{ child.nickname }}</option>
                        {% endfor %}
                    </select>
                    <h2>の名言を登録する</h2>
                </div>

                <!-- 名言 -->
                <label for="content">名言 <span style="color:red;">※必須</span></label>
                <input type="text" name="content" id="content" required>
                
                <!-- 日付 -->
                <div class="date-range">
                    <label for="start_date">日付</label>
                    <div class="date-inputs">
                        <input type="date" name="start_date" id="start_date" class="date-input">
                        <span class="date-separator">〜</span>
                        <input type="date" name="end_date" id="end_date" class="date-input">
                    </div>
                </div>                

                <!-- 説明 -->
                <label for="description">説明</label>
                <textarea name="description" id="description"></textarea>

                <!-- カテゴリ -->
                <label for="category">カテゴリ</label>
                <select name="category" id="category">
                    <option value="">--選択してください--</option>
                    {% for category in categories %}
                        <option value="{{ category.id }}" {% if category.id == quote.category.id %}selected{% endif %}>{{ category.category_name }}</option>
                    {% endfor %}
                </select>                

                <!-- 画像選択 -->
                <label for="image">写真</label>
                <input type="file" name="image" id="image">
                 
                <!-- 登録ボタン -->
                <button type="submit">登録</button>
            </form>                         
        </div>
    </div>
            

    <!-- 固定ボタンでモーダルを開く -->
    <button class="fixed-add-btn" onclick="openQuoteModal()">+</button>

    <script src="{% static 'js/modal.js' %}"></script>
</body>
</html>
